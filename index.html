<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ÙƒØ§Ø´Ù Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª â€” Ø¹Ø²ÙˆØ² (Ù…Ø­Ø³Ù‘Ù†)</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=Amiri:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root{
      --bg1:#e8f5e9; --bg2:#d0f0d6;
      --card:#fff; --accent:#2e7d32; --accent-2:#43a047; --danger:#d32f2f;
      --muted:#657665; --glass: rgba(255,255,255,0.8);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:"Cairo",sans-serif; background: linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#133612; padding:18px;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    .header{background:var(--card); border-radius:16px; padding:20px; text-align:center; box-shadow:0 10px 30px rgba(16,88,37,0.08)}
    .logo{width:78px;height:78px;border-radius:50%;display:inline-grid;place-items:center;background:var(--accent);color:#fff;font-weight:800;font-size:1.6rem;margin:0 auto}
    h1{margin:12px 0 0;font-size:1.5rem;font-weight:800;color:var(--accent)}
    .subtitle{color:var(--accent-2);font-weight:700;margin-top:6px}
    .engineer{font-family:'Amiri',serif;margin-top:10px;color:var(--accent);font-weight:700}

    .container{max-width:720px;margin:22px auto;background:var(--card);padding:22px;border-radius:16px;box-shadow:0 18px 40px rgba(19,54,18,0.06)}

    /* upload */
    .upload-area{border:2.5px dashed rgba(46,125,50,0.18);border-radius:12px;padding:30px;text-align:center;cursor:pointer;transition:all .25s}
    .upload-area:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(46,125,50,0.06)}
    .upload-icon{display:block;font-size:1.6rem;color:var(--accent);margin-bottom:8px;font-weight:800}
    .upload-text{font-weight:700;color:var(--muted)}

    /* preview */
    #preview{display:none;width:100%;max-height:360px;object-fit:contain;border-radius:12px;margin-top:14px;border:1px solid rgba(34,139,34,0.06);box-shadow:0 8px 30px rgba(16,88,37,0.05)}

    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px;align-items:center;justify-content:center}
    .btn{background:var(--accent-2);color:#fff;border:none;padding:12px 20px;border-radius:999px;font-weight:800;cursor:pointer;box-shadow:0 8px 20px rgba(67,160,71,0.16)}
    .btn:disabled{opacity:.55;cursor:not-allowed}

    .loader{display:none;margin:18px auto;border:6px solid #f0fff0;border-top-color:var(--accent);width:56px;height:56px;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* result card */
    .result{display:none;margin-top:22px;padding:18px;border-radius:12px;background:linear-gradient(180deg,#f7fff7,#f0fff4);border:1px solid rgba(67,160,71,0.12);box-shadow:0 10px 30px rgba(46,125,50,0.04)}
    .result-head{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .disease-badge{display:flex;align-items:center;gap:12px;background:rgba(46,125,50,0.06);padding:10px 14px;border-radius:12px;border:1px solid rgba(46,125,50,0.08)}
    .disease-icon{width:48px;height:48;border-radius:10px;background:linear-gradient(180deg,var(--accent),var(--accent-2));display:grid;place-items:center;color:#fff;font-weight:800;font-size:1.1rem}
    .disease-title{font-size:1.15rem;font-weight:800;color:#123a18}
    .disease-sub{font-size:0.86rem;color:var(--muted);margin-top:4px}

    /* pill to show Arabic name nicely */
    .disease-arabic{display:inline-block;background:#fff;border-radius:999px;padding:10px 16px;font-weight:800;font-size:1.1rem;color:var(--accent-2);box-shadow:0 6px 20px rgba(67,160,71,0.08);border:1px solid rgba(67,160,71,0.08)}
    .disease-english{display:block;font-size:0.82rem;color:var(--muted);margin-top:6px;text-align:right}

    /* confidence */
    .conf-row{margin-top:12px;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .conf-text{font-weight:700;color:var(--muted);min-width:110px}
    .conf-bar{flex:1;height:14px;background:#f1f7f1;border-radius:999px;overflow:hidden;border:1px solid rgba(0,0,0,0.03)}
    .conf-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent-2),var(--accent));border-radius:999px;transition:width .6s ease}
    .conf-value{min-width:64px;text-align:left;font-weight:800;color:var(--accent-2)}

    .debug{margin-top:16px;background:#fff8e1;padding:12px;border-radius:8px;font-family:monospace;font-size:0.85rem;max-height:260px;overflow:auto;border:1px solid #ffe082;display:none}

    .error{display:none;margin-top:16px;padding:12px;border-radius:8px;background:#ffebee;color:#b71c1c;border:1px solid #ffcdd2}

    footer{margin-top:28px;text-align:center;color:var(--muted)}
    @media (min-width:880px){
      .container{padding:28px}
      .disease-title{font-size:1.25rem}
      .disease-arabic{font-size:1.25rem;padding:12px 20px}
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="logo">Leaf</div>
    <h1>ÙƒØ§Ø´Ù Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª</h1>
    <div class="subtitle">ÙˆØ§ØªØ³ 01119935714</div>
    <div class="engineer">Ù…. Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¹Ø²ÙˆØ²</div>
  </div>

  <div class="container">
    <div class="upload-area" id="upload-area">
      <div class="upload-icon">Leaf</div>
      <div class="upload-text">Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø±ÙØ¹</div>
      <input type="file" id="file-input" accept="image/*" style="display:none"/>
    </div>

    <img id="preview" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©" />

    <div class="controls">
      <button class="btn" id="analyze-btn" disabled><i class="fas fa-search"></i>&nbsp; ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¢Ù†</button>
      <div class="loader" id="loader"></div>
    </div>

    <div class="result" id="result">
      <div class="result-head">
        <div style="flex:1;min-width:220px;text-align:right">
          <div class="disease-badge">
            <div class="disease-icon" id="disease-icon">ğŸŒ¿</div>
            <div style="text-align:right">
              <div class="disease-title" id="disease-arabic">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</div>
              <div class="disease-sub" id="disease-sub">â€”</div>
            </div>
          </div>
        </div>

        <div style="min-width:180px;text-align:left">
          <div class="disease-arabic" id="disease-pill">â€”</div>
          <div class="disease-english" id="disease-english">Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ø§Ù„Ø£ØµÙ„ÙŠ</div>
        </div>
      </div>

      <div class="conf-row">
        <div class="conf-text">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø©</div>
        <div class="conf-bar" aria-hidden="true">
          <div class="conf-fill" id="conf-fill"></div>
        </div>
        <div class="conf-value" id="conf-value">0%</div>
      </div>
    </div>

    <div class="debug" id="debug">
      <strong>Ø§Ù„Ù€ JSON Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† Roboflow:</strong>
      <pre id="json-output"></pre>
    </div>

    <div class="error" id="error-msg"></div>
  </div>

  <footer>
    Â© 2025 Ù…. Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¹Ø²ÙˆØ² â€” Ù…Ø¯Ø¹ÙˆÙ… Roboflow
  </footer>

  <script>
    /* --------- Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„ØªØ±Ø¬Ù…Ø© (Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù€ 88 Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§) ---------
       Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª ØªØ¹Ø¯ÙŠÙ„ Ø£ÙŠ ØªØ±Ø¬Ù…Ø© ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨Ø© ØºÙŠÙ‘Ø± Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙØªØ§Ø­. */
    const labelTranslations = {
      "Apple__black_rot": "ØªØ¹ÙÙ‘Ù† Ø£Ø³ÙˆØ¯ (ØªÙØ§Ø­)",
      "Apple__healthy": "ØªÙØ§Ø­ Ø³Ù„ÙŠÙ…",
      "Apple__rust": "ØµØ¯Ø£ Ø§Ù„ØªÙØ§Ø­",
      "Apple__scab": "Ù‚ÙØ±Ø­Ø© Ø§Ù„ØªÙØ§Ø­ (Scab)",
      "Cassava__bacterial_blight": "ØªØ¹ÙÙ† Ø¨ÙƒØªÙŠØ±ÙŠ (Ø§Ù„ÙƒØ³Ø§ÙØ§)",
      "Cassava__brown_streak_disease": "Ù…Ø±Ø¶ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ù†ÙŠ (ÙƒØ³Ø§ÙØ§)",
      "Cassava__green_mottle": "Ø¨Ù‚Ø¹ Ø®Ø¶Ø±Ø§Ø¡ (ÙƒØ³Ø§ÙØ§)",
      "Cassava__healthy": "ÙƒØ³Ø§ÙØ§ Ø³Ù„ÙŠÙ…",
      "Cassava__mosaic_disease": "Ù…Ø±Ø¶ Ø§Ù„Ù…ÙˆØ²Ø§ÙŠÙŠÙƒ (ÙƒØ³Ø§ÙØ§)",
      "Cherry__healthy": "ÙƒØ±Ø² Ø³Ù„ÙŠÙ…",
      "Cherry__powdery_mildew": "Ø¹ÙÙ† Ø¨ÙˆØ¯Ø±ÙŠ (ÙƒØ±Ø²)",
      "Chili__healthy": "ÙÙ„ÙÙ„ Ø­Ø§Ø± Ø³Ù„ÙŠÙ…",
      "Chili__leaf curl": "Ø§Ù„ØªÙØ§Ù Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ (ÙÙ„ÙÙ„)",
      "Chili__leaf spot": "Ø¨Ù‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ±Ù‚Ø© (ÙÙ„ÙÙ„)",
      "Chili__whitefly": "Ø°Ø¨Ø§Ø¨Ø© Ø¨ÙŠØ¶Ø§Ø¡ (ÙÙ„ÙÙ„)",
      "Chili__yellowish": "Ø§ØµÙØ±Ø§Ø± (ÙÙ„ÙÙ„)",
      "Coffee__cercospora_leaf_spot": "Ø¨Ù‚Ø¹ Cercospora (Ù‚Ù‡ÙˆØ©)",
      "Coffee__healthy": "Ù‚Ù‡ÙˆØ© Ø³Ù„ÙŠÙ…Ø©",
      "Coffee__red_spider_mite": "Ø¹Ø«Ø© Ø­Ù…Ø±Ø§Ø¡ (Ù‚Ù‡ÙˆØ©)",
      "Coffee__rust": "ØµØ¯Ø£ Ø§Ù„Ù‚Ù‡ÙˆØ©",
      "Corn__common_rust": "Ø§Ù„ØµØ¯Ø£ Ø§Ù„Ø´Ø§Ø¦Ø¹ (Ø°Ø±Ø©)",
      "Corn__gray_leaf_spot": "Ø¨Ù‚Ø¹Ø© Ø±Ù…Ø§Ø¯ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ±Ù‚Ø© (Ø°Ø±Ø©)",
      "Corn__healthy": "Ø°Ø±Ø© Ø³Ù„ÙŠÙ…Ø©",
      "Corn__northern_leaf_blight": "ØªØ¹ÙÙ† Ø£ÙˆØ±Ø§Ù‚ Ø´Ù…Ø§Ù„ÙŠ (Ø°Ø±Ø©)",
      "Cucumber__diseased": "Ø®ÙŠØ§Ø± Ù…ØµØ§Ø¨",
      "Cucumber__healthy": "Ø®ÙŠØ§Ø± Ø³Ù„ÙŠÙ…",
      "Gauva__diseased": "Ø¬ÙˆØ§ÙØ© Ù…ØµØ§Ø¨Ø©",
      "Gauva__healthy": "Ø¬ÙˆØ§ÙØ© Ø³Ù„ÙŠÙ…Ø©",
      "Grape__black_measles": "Ø­ÙÙ…Ø±Ø© Ø³ÙˆØ¯Ø§Ø¡ (Ø¹Ù†Ø¨)",
      "Grape__black_rot": "ØªØ¹ÙÙ† Ø£Ø³ÙˆØ¯ (Ø¹Ù†Ø¨)",
      "Grape__healthy": "Ø¹Ù†Ø¨ Ø³Ù„ÙŠÙ…",
      "Grape__leaf_blight_(isariopsis_leaf_spot)": "ØªØ¹ÙÙ† Ø£ÙˆØ±Ø§Ù‚ (Isariopsis) (Ø¹Ù†Ø¨)",
      "Jamun__diseased": "Ø¬Ø§Ù…Ù† Ù…ØµØ§Ø¨",
      "Jamun__healthy": "Ø¬Ø§Ù…Ù† Ø³Ù„ÙŠÙ…",
      "Lemon__diseased": "Ù„ÙŠÙ…ÙˆÙ† Ù…ØµØ§Ø¨",
      "Lemon__healthy": "Ù„ÙŠÙ…ÙˆÙ† Ø³Ù„ÙŠÙ…",
      "Mango__diseased": "Ù…Ø§Ù†Ø¬Ùˆ Ù…ØµØ§Ø¨",
      "Mango__healthy": "Ù…Ø§Ù†Ø¬Ùˆ Ø³Ù„ÙŠÙ…",
      "Peach__bacterial_spot": "Ø¨Ù‚Ø¹ Ø¨ÙƒØªÙŠØ±ÙŠØ© (Ø®ÙˆØ®)",
      "Peach__healthy": "Ø®ÙˆØ® Ø³Ù„ÙŠÙ…",
      "Pepper_bell__bacterial_spot": "Ø¨Ù‚Ø¹ Ø¨ÙƒØªÙŠØ±ÙŠØ© (ÙÙ„ÙÙ„ Ø±ÙˆÙ…ÙŠ)",
      "Pepper_bell__healthy": "ÙÙ„ÙÙ„ Ø±ÙˆÙ…ÙŠ Ø³Ù„ÙŠÙ…",
      "Pomegranate__diseased": "Ø±Ù…Ø§Ù† Ù…ØµØ§Ø¨",
      "Pomegranate__healthy": "Ø±Ù…Ø§Ù† Ø³Ù„ÙŠÙ…",
      "Potato__early_blight": "ØªØ¹ÙÙ† Ù…Ø¨ÙƒÙ‘Ø± (Ø¨Ø·Ø§Ø·Ø³)",
      "Potato__healthy": "Ø¨Ø·Ø§Ø·Ø³ Ø³Ù„ÙŠÙ…Ø©",
      "Potato__late_blight": "ØªØ¹ÙÙ† Ù…ØªØ£Ø®Ø± (Ø¨Ø·Ø§Ø·Ø³)",
      "Rice__brown_spot": "Ø¨Ù‚Ø¹Ø© Ø¨Ù†ÙŠØ© (Ø£Ø±Ø²)",
      "Rice__healthy": "Ø£Ø±Ø² Ø³Ù„ÙŠÙ…",
      "Rice__hispa": "Ø­ÙØ³Ù’Ø¨Ø§ (Ø­Ø´Ø±Ø©) (Ø£Ø±Ø²)",
      "Rice__leaf_blast": "Ø§Ù†ÙØ¬Ø§Ø± Ø§Ù„ÙˆØ±Ù‚Ø© (Leaf blast) (Ø£Ø±Ø²)",
      "Rice__neck_blast": "Ø§Ù†ÙØ¬Ø§Ø± Ø§Ù„Ø¹Ù†Ù‚ (Ø£Ø±Ø²)",
      "Soybean__bacterial_blight": "ØªØ¹ÙÙ† Ø¨ÙƒØªÙŠØ±ÙŠ (ÙÙˆÙ„ Ø§Ù„ØµÙˆÙŠØ§)",
      "Soybean__caterpillar": "ÙŠØ±Ù‚Ø© Ø¢ÙƒÙ„Ø© (ÙÙˆÙ„ Ø§Ù„ØµÙˆÙŠØ§)",
      "Soybean__diabrotica_speciosa": "Ø¢ÙØ© Diabrotica (ÙÙˆÙ„ Ø§Ù„ØµÙˆÙŠØ§)",
      "Soybean__downy_mildew": "Ø¹ÙÙ† Ø£Ø¨ÙŠØ¶ Ø²ØºØ¨ÙŠ (ÙÙˆÙ„ Ø§Ù„ØµÙˆÙŠØ§)",
      "Soybean__healthy": "ÙÙˆÙ„ Ø§Ù„ØµÙˆÙŠØ§ Ø³Ù„ÙŠÙ…",
      "Soybean__mosaic_virus": "ÙÙŠØ±ÙˆØ³ Ø§Ù„Ù…ÙˆØ²Ø§ÙŠÙŠÙƒ (ÙÙˆÙ„ Ø§Ù„ØµÙˆÙŠØ§)",
      "Soybean__powdery_mildew": "Ø¹ÙÙ† Ø¨ÙˆØ¯Ø±ÙŠ (ÙÙˆÙ„ Ø§Ù„ØµÙˆÙŠØ§)",
      "Soybean__rust": "ØµØ¯Ø£ (ÙÙˆÙ„ Ø§Ù„ØµÙˆÙŠØ§)",
      "Soybean__southern_blight": "ØªØ¹ÙÙ† Ø¬Ù†ÙˆØ¨ÙŠ (ÙÙˆÙ„ Ø§Ù„ØµÙˆÙŠØ§)",
      "Strawberry___leaf_scorch": "Ø§Ø­ØªØ±Ø§Ù‚ ÙˆØ±Ù‚ÙŠ (ÙØ±Ø§ÙˆÙ„Ø©)",
      "Strawberry__healthy": "ÙØ±Ø§ÙˆÙ„Ø© Ø³Ù„ÙŠÙ…Ø©",
      "Sugarcane__bacterial_blight": "ØªØ¹ÙÙ† Ø¨ÙƒØªÙŠØ±ÙŠ (Ù‚ØµØ¨ Ø§Ù„Ø³ÙƒØ±)",
      "Sugarcane__healthy": "Ù‚ØµØ¨ Ø³ÙƒØ± Ø³Ù„ÙŠÙ…",
      "Sugarcane__red_rot": "ØªØ¹ÙÙ† Ø£Ø­Ù…Ø± (Ù‚ØµØ¨ Ø§Ù„Ø³ÙƒØ±)",
      "Sugarcane__red_stripe": "Ø´Ø±ÙŠØ· Ø£Ø­Ù…Ø± (Ù‚ØµØ¨ Ø§Ù„Ø³ÙƒØ±)",
      "Sugarcane__rust": "ØµØ¯Ø£ (Ù‚ØµØ¨ Ø§Ù„Ø³ÙƒØ±)",
      "Tea__algal_leaf": "Ø·ÙÙŠÙ„ÙŠØ§Øª Ø·Ø­Ù„Ø¨ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ±Ù‚Ø© (Ø´Ø§ÙŠ)",
      "Tea__anthracnose": "Ø£Ù†Ø«Ø±Ø§ÙƒÙ†ÙˆØ² (Ø´Ø§ÙŠ)",
      "Tea__bird_eye_spot": "Ø¨Ù‚Ø¹Ø© Ø¹ÙŠÙ† Ø§Ù„Ø·Ø§ÙˆÙˆØ³ (Ø´Ø§ÙŠ)",
      "Tea__brown_blight": "ØªØ¹ÙÙ† Ø¨Ù†ÙŠ (Ø´Ø§ÙŠ)",
      "Tea__healthy": "Ø´Ø§ÙŠ Ø³Ù„ÙŠÙ…",
      "Tea__red_leaf_spot": "Ø¨Ù‚Ø¹Ø© Ø­Ù…Ø±Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ±Ù‚Ø© (Ø´Ø§ÙŠ)",
      "Tomato__bacterial_spot": "Ø¨Ù‚Ø¹Ø© Ø¨ÙƒØªÙŠØ±ÙŠØ© (Ø·Ù…Ø§Ø·Ù…)",
      "Tomato__early_blight": "ØªØ¹ÙÙ† Ù…Ø¨ÙƒÙ‘Ø± (Ø·Ù…Ø§Ø·Ù…)",
      "Tomato__healthy": "Ø·Ù…Ø§Ø·Ù… Ø³Ù„ÙŠÙ…Ø©",
      "Tomato__late_blight": "ØªØ¹ÙÙ† Ù…ØªØ£Ø®Ø± (Ø·Ù…Ø§Ø·Ù…)",
      "Tomato__leaf_mold": "Ø¹ÙÙ† Ø§Ù„ÙˆØ±Ù‚Ø© (Ø·Ù…Ø§Ø·Ù…)",
      "Tomato__mosaic_virus": "ÙÙŠØ±ÙˆØ³ Ù…ÙˆØ²Ø§ÙŠÙŠÙƒ (Ø·Ù…Ø§Ø·Ù…)",
      "Tomato__septoria_leaf_spot": "Ø¨Ù‚Ø¹Ø© Septoria (Ø·Ù…Ø§Ø·Ù…)",
      "Tomato__spider_mites_(two_spotted_spider_mite)": "Ø¹Ø« Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª (Ø·Ù…Ø§Ø·Ù…)",
      "Tomato__target_spot": "Ø¨Ù‚Ø¹Ø© Ù…Ø³ØªÙ‡Ø¯ÙØ© (Ø·Ù…Ø§Ø·Ù…)",
      "Tomato__yellow_leaf_curl_virus": "ÙÙŠØ±ÙˆØ³ Ø§Ù„ØªÙˆØ§Ø¡ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„ØµÙØ±Ø§Ø¡ (Ø·Ù…Ø§Ø·Ù…)",
      "Wheat__brown_rust": "ØµØ¯Ø£ Ø¨Ù†ÙŠ (Ù‚Ù…Ø­)",
      "Wheat__healthy": "Ù‚Ù…Ø­ Ø³Ù„ÙŠÙ…",
      "Wheat__septoria": "Ø³Ø¨ØªÙˆØ±ÙŠØ§ (Ù‚Ù…Ø­)",
      "Wheat__yellow_rust": "ØµØ¯Ø£ Ø£ØµÙØ± (Ù‚Ù…Ø­)"
    };

    /* ------------ Ø¹Ù†Ø§ØµØ± DOM ------------ */
    const uploadArea = document.getElementById('upload-area');
    const fileInput = document.getElementById('file-input');
    const preview = document.getElementById('preview');
    const analyzeBtn = document.getElementById('analyze-btn');
    const loader = document.getElementById('loader');
    const result = document.getElementById('result');
    const diseaseArabicEl = document.getElementById('disease-arabic');
    const diseaseSubEl = document.getElementById('disease-sub');
    const diseasePill = document.getElementById('disease-pill');
    const diseaseEnglish = document.getElementById('disease-english');
    const confFill = document.getElementById('conf-fill');
    const confValue = document.getElementById('conf-value');
    const debug = document.getElementById('debug');
    const jsonOutput = document.getElementById('json-output');
    const errorMsg = document.getElementById('error-msg');
    const diseaseIcon = document.getElementById('disease-icon');

    /* ØªÙØ§Ø¹Ù„ Ø§Ù„Ø±ÙØ¹ */
    uploadArea.addEventListener('click',()=>fileInput.click());
    ['dragenter','dragover'].forEach(ev=>uploadArea.addEventListener(ev,e=>{e.preventDefault();uploadArea.style.boxShadow='0 12px 32px rgba(46,125,50,0.06)'}));
    ['dragleave','drop'].forEach(ev=>uploadArea.addEventListener(ev,e=>{e.preventDefault();uploadArea.style.boxShadow='none'}));
    uploadArea.addEventListener('drop',e=>{
      const f = e.dataTransfer.files[0];
      if(f && f.type.startsWith('image/')) handleFile(f);
    });
    fileInput.addEventListener('change',()=>{ if(fileInput.files[0]) handleFile(fileInput.files[0]); });

    function handleFile(file){
      const reader = new FileReader();
      reader.onload = e=>{
        preview.src = e.target.result;
        preview.style.display = 'block';
        analyzeBtn.disabled = false;
        result.style.display = 'none';
        debug.style.display = 'none';
        errorMsg.style.display = 'none';
      };
      reader.readAsDataURL(file);
    }

    function fileToBase64(file){
      return new Promise((res,rej)=>{
        const r = new FileReader();
        r.onload = ()=>res(r.result.split(',')[1]);
        r.onerror = rej;
        r.readAsDataURL(file);
      });
    }

    /* Ø¯Ø§Ù„Ø© Ù…Ø±Ù†Ø© Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªÙˆÙ‚Ø¹ Ù…Ù† JSON (ÙƒÙ…Ø§ Ø¨Ø§Ù„Ø±Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚) */
    function findPrediction(node){
      if(node==null) return null;
      if(Array.isArray(node)){
        for(const it of node){
          const s = findPrediction(it);
          if(s) return s;
        }
        return null;
      }
      if(typeof node!=='object') return null;

      if(node.predictions && Array.isArray(node.predictions) && node.predictions.length>0){
        const p = node.predictions[0];
        const label = p.class || p.label || p.name || p.title || p.predicted_class || null;
        const conf = (p.confidence ?? p.score ?? p.probability ?? p.conf ?? null) ?? null;
        return {label, confidence: conf};
      }
      if(node.top || node.label || node.class || node.name){
        const lab = node.top || node.label || node.class || node.name;
        const conf = node.confidence ?? node.conf ?? node.score ?? null;
        return {label:lab, confidence:conf};
      }
      for(const k of Object.keys(node)){
        try{
          const s = findPrediction(node[k]);
          if(s) return s;
        }catch(e){}
      }
      return null;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¶: ØªØ­ÙˆÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø¥Ù„Ù‰ Ù†Øµ Ø¬Ù…ÙŠÙ„ Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ØªØ±Ø¬Ù…Ø© */
    function beautifyLabel(raw){
      if(!raw) return 'Ù†Ø¨Ø§Øª Ø³Ù„ÙŠÙ…';
      // Ø£Ø²Ù„ Ø¨Ø§Ø¯Ø¦Ø§Øª Ù…Ø«Ù„ anything__ and triple underscores
      let s = String(raw).trim();
      // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ double underscores Ø¨Ù€ " - " Ø£Ùˆ space
      s = s.replace(/__+/g,' - ').replace(/_/g,' ');
      // ØªÙØ±ÙŠØº Ø£Ø­Ø±Ù ØºÙŠØ± Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡Ø§
      return s;
    }

    /* ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© */
    function showResult(labelRaw, confidenceRaw){
      // labelRaw Ù…Ø«Ù„ "Apple__black_rot" Ø£Ùˆ "apple__black_rot"
      const originalLabel = String(labelRaw || '');
      const key = originalLabel.trim();
      const arabic = labelTranslations[key] || labelTranslations[key.replace(/\s+/g,'')] || null;
      const displayedArabic = arabic || beautifyLabel(originalLabel);

      // Ø£Ø­Ø¶Ø± Ø§Ø³Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù…Ù†Ø³Ù‚ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµØºÙŠØ±
      const englishPretty = beautifyLabel(originalLabel);

      // Ø§Ù„Ø«Ù‚Ø©: Ù‚Ø¯ ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 0-1 Ø£Ùˆ 0-100 Ø£Ùˆ null
      let confNum = null;
      if(confidenceRaw!==null && confidenceRaw!==undefined){
        confNum = Number(confidenceRaw);
        if(!isFinite(confNum)) confNum = null;
        if(confNum!==null){
          if(confNum <= 1) confNum = confNum * 100;
          confNum = Math.min(Math.max(confNum,0),100);
        }
      }
      if(confNum===null) confNum = 0;

      // Ø§Ø¶Ø¨Ø· Ø§Ù„Ù†ØµÙˆØµ
      diseaseArabicEl.textContent = displayedArabic;
      diseasePill.textContent = displayedArabic;
      diseaseEnglish.textContent = englishPretty || originalLabel || 'â€”';
      diseaseSubEl.textContent = originalLabel ? `Ø§Ù„ØµÙ†Ù Ø§Ù„Ù…ÙƒØªØ´Ù: ${originalLabel}` : 'â€”';

      // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ø³ÙŠØ·Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±Ø¶ (Ù„Ùˆ Ø³Ù„ÙŠÙ… Ø£Ø¹Ø±Ø¶ ÙˆØ±Ù‚Ø© Ø®Ø¶Ø±Ø§Ø¡)
      const lower = (displayedArabic+'').toLowerCase();
      if(lower.includes('Ø³Ù„ÙŠÙ…') || lower.includes('healthy')) diseaseIcon.textContent = 'ğŸƒ';
      else if(lower.includes('ØªØ¹ÙÙ†') || lower.includes('rot') || lower.includes('blight')) diseaseIcon.textContent = 'âš ï¸';
      else if(lower.includes('ØµØ¯Ø£')|| lower.includes('rust')) diseaseIcon.textContent = 'ğŸŸ ';
      else diseaseIcon.textContent = 'ğŸ”¬';

      // Ø´Ø±ÙŠØ· Ø§Ù„Ø«Ù‚Ø©
      confFill.style.width = confNum + '%';
      confValue.textContent = confNum.toFixed(1) + '%';

      // Ø£Ø¸Ù‡Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø©
      result.style.display = 'block';
    }

    /* ---------- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Roboflow (ÙƒÙ…Ø§ ÙƒØ§Ù†Øª) ---------- */
    const API_KEY = 'XE4MvnlqbKziC4aahMKI';
    const WORKFLOW_URL = 'https://serverless.roboflow.com/poultrycounterazouz/workflows/detect-and-classify-2';

    analyzeBtn.addEventListener('click', async ()=>{
      const file = fileInput.files[0];
      if(!file) return;
      analyzeBtn.disabled = true;
      loader.style.display = 'block';
      result.style.display = 'none';
      debug.style.display = 'none';
      errorMsg.style.display = 'none';

      try{
        const base64 = await fileToBase64(file);
        const resp = await fetch(WORKFLOW_URL, {
          method:'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ api_key: API_KEY, inputs: { image: { type: "base64", value: base64 } } })
        });
        if(!resp.ok){
          const txt = await resp.text();
          throw new Error(`HTTP ${resp.status}: ${txt.substring(0,300)}`);
        }
        const data = await resp.json();
        console.log('RF response', data);
        jsonOutput.textContent = JSON.stringify(data, null, 2);
        debug.style.display = 'block';
        loader.style.display = 'none';

        const pred = findPrediction(data);
        if(pred && pred.label){
          showResult(pred.label, pred.confidence ?? pred.score ?? null);
        } else {
          // Ø§ÙØªØ±Ø§Ø¶ Ø³Ù„ÙŠÙ… Ø¥Ù† Ù„Ù… ÙŠÙˆØ¬Ø¯ ØªÙˆÙ‚Ø¹
          showResult('healthy', 1.0);
        }
      }catch(err){
        console.error(err);
        loader.style.display = 'none';
        errorMsg.textContent = 'Ø®Ø·Ø£: ' + (err.message || String(err));
        errorMsg.style.display = 'block';
      }finally{
        analyzeBtn.disabled = false;
      }
    });

    /* Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” Ù„Ùˆ ØªØ±ÙŠØ¯ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù€ debug ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 20 Ø«Ø§Ù†ÙŠØ© Ù…Ù† Ø¹Ø±Ø¶Ù‡:
    const observer = new MutationObserver(()=>{ if(debug.style.display==='block'){ setTimeout(()=>debug.style.display='none', 20000); }});
    observer.observe(jsonOutput,{childList:true, subtree:true});
    */

  </script>
</body>
</html>
